YUI.add("wireit-app",function(c,b){function a(h){var f;if(!h){c.error("No storage key specified.");}if(c.config.win.localStorage){f=c.config.win.localStorage;}var j=c.JSON.parse((f&&f.getItem(h))||"{}");function g(m){var l;if((l=j[m])){delete j[m];i();}return l;}function d(){var m="",l=4;while(l--){m+=(((1+Math.random())*65536)|0).toString(16).substring(1);}return m;}function e(l){return l?j[l]:c.Object.values(j);}function i(){f&&f.setItem(h,c.JSON.stringify(j));}function k(l){var n=l.toJSON(),m=l.idAttribute;if(!c.Lang.isValue(n[m])){n[m]=d();}j[n[m]]=n;i();return n;}return function(n,l,o){var m=c.Model&&this instanceof c.Model;switch(n){case"create":case"update":o(null,k(this));return;case"read":o(null,e(m&&this.get("id")));return;case"delete":o(null,g(m&&this.get("id")));return;}};}c.WiringModel=c.Base.create("wiringModel",c.Model,[],{sync:a("wireit-app")},{ATTRS:{id:{value:null},name:{value:""},containers:{value:[]},description:{value:""},wires:{value:[]}}});c.WiringModelList=c.Base.create("wiringModelList",c.ModelList,[],{sync:a("wireit-app"),model:c.WiringModel});c.WiringListView=c.Base.create("wiringListView",c.View,[],{template:c.Handlebars.compile(c.one("#t-wiring-list").getContent()),initializer:function(){},render:function(){var d=this.template({wirings:this.get("modelList").toJSON()});this.get("container").setContent(d);return this;}});c.ContainerType=c.Base.create("containerModel",c.Model,[],{idAttribute:"name"},{ATTRS:{name:{value:null},description:{value:null},config:{value:null}}});c.ContainerTypeList=c.Base.create("containerTypeList",c.ModelList,[],{model:c.ContainerType});c.EditorView=c.Base.create("editorView",c.View,[],{template:c.Handlebars.compile(c.one("#t-editor").getContent()),events:{"#wiring-save-btn":{click:"saveWiring"}},render:function(){var e=this.template({containerTypes:this.get("containerTypes").toJSON()});this.get("container").setContent(e);var d=this;this.get("container").all(".containerType-name").each(function(g){var f=new c.DD.Drag({node:g,groups:["containerType"]}).plug(c.Plugin.DDProxy,{cloneNode:true,moveOnEnd:false});f._containerTypeName=g._node.innerHTML;f.on("drag:drophit",function(h){d._addContainerFromName(h.drag._containerTypeName,{x:h.drag.lastXY[0],y:h.drag.lastXY[1]});});});this._renderLayer();return this;},_renderLayer:function(){this.layer=new c.Layer({height:500});var d=new c.DD.Drop({node:this.layer.get("contentBox"),groups:["containerType"]});var e=this.get("model");if(e){this.setWiring(e);}this.layer.render(this.get("container").one("#layer-container"));},saveWiring:function(h){var i={name:c.one("#wiring-name").get("value")||"Unnamed"};i.containers=[];c.Array.each(this.layer._items,function(e){i.containers.push({containerType:e.containerTypeName,config:e.toJSON()});});i.wires=[];var d=this.layer;c.Array.each(this.layer._wires,function(j){var e=j.get("src");var k=j.get("tgt");i.wires.push({src:{container:d._items.indexOf(e.get("parent")),terminal:e.get("name")},tgt:{container:d._items.indexOf(k.get("parent")),terminal:k.get("name")},config:j.toJSON()});});if(this.get("model")){this.get("model").setAttrs(i);}else{this.set("model",new c.WiringModel(i));}this.get("model").save();var f=c.Node.create('<div class="alert-message warning" style="width: 300px; z-index: 10001;"><p>Saved !</p></div>').appendTo(document.body);var g=new c.Anim({node:f,duration:0.5,easing:c.Easing.easeOut,from:{xy:[400,-50]},to:{xy:[400,2]}});g.on("end",function(){c.later(1000,this,function(){(new c.Anim({node:f,duration:0.5,easing:c.Easing.easeOut,to:{xy:[400,-50]}})).run();});});g.run();},setWiring:function(f){var e=this;var d=this.layer;c.Array.each(f.get("containers"),function(g){e._addContainerFromName(g.containerType,g.config);c.on("available",function(h){c.one("#wiring-name").set("value",f.get("name"));},"#wiring-name");});c.Array.each(f.get("wires"),function(l){if(!l.src||!l.tgt){return;}var i=d.item(l.src.container);var k=i.getTerminal(l.src.terminal);var j=d.item(l.tgt.container);var g=j.getTerminal(l.tgt.terminal);var h=d.graphic.addShape({type:c.BezierWire,stroke:{weight:4,color:"rgb(173,216,230)"},src:k,tgt:g});});c.later(1000,this,function(){d.redrawAllWires();});},_addContainerFromName:function(e,g){var h=this.get("containerTypes").getById(e);var f=c.mix({},h.get("config"));f=c.mix(f,g);this.layer.add(f);var d=this.layer.item(this.layer.size()-1);d.containerTypeName=e;}},{ATTRS:{containerTypes:{value:null}}});c.WireItApp=new c.Base.create("contributorsApp",c.App,[],{views:{editorPage:{type:c.EditorView},wiringListPage:{type:c.WiringListView}},initializer:function(){this.on("navigate",this.indicateLoading);this.once("ready",function(d){if(this.hasRoute(this.getPath())){this.dispatch();}else{this.showWiringListPage();}});},indicateLoading:function(d){this.get("activeView").get("container").addClass("loading");},handleWiring:function(f,d,e){var g=f.params.wiring,i=this.get("modelList"),h=i.getById(g);this.set("wiring",h);e();},showEditorPage:function(){this.showView("editorPage",{containerTypes:this.get("containerTypes"),wirings:this.get("modelList"),model:this.get("wiring")});},blankEditorPage:function(){this.showView("editorPage",{containerTypes:this.get("containerTypes"),wirings:this.get("modelList"),model:null});},showWiringListPage:function(){var d=new c.WiringModelList();d.load();this.set("modelList",d);this.showView("wiringListPage",{modelList:this.get("modelList")});}},{ATTRS:{containerTypes:{value:new c.ContainerTypeList()},modelList:{value:new c.WiringModelList()},wiring:{value:null},routes:{value:[{path:"/",callback:"showWiringListPage"},{path:"/wirings/:wiring/*",callback:"handleWiring"},{path:"/wirings/:wiring/edit",callback:"showEditorPage"},{path:"/wirings/new",callback:"blankEditorPage"}]}}});},"@VERSION@",{"requires":["app","handlebars","model","model-list","json","view","layer","bezier-wire","anim"]});